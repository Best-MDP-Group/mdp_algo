<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path Generation Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        #gridContainer {
            display: grid;
            grid-template-columns: 30px auto;
            grid-template-rows: 30px auto;
            margin: 20px;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(20, 20px);
            gap: 2px;
            grid-row: 2;
            grid-column: 2;
        }

        
        #columnLabels {
            display: grid;
            gap: 2px;
        }

        #rowLabels {
            display: grid;
            gap: 4px;
        }

        #rowLabels {
            grid-template-rows: repeat(20, 20px);
            grid-row: 2;
            grid-column: 1;
        }

        #columnLabels {
            grid-template-columns: repeat(20, 20px);
            grid-row: 1;
            grid-column: 2;
        }

        .label {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #555;
        }

        .cell {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: background-color 0.3s;
        }

        .cell:hover {
            background-color: #eaeaea;
        }

        .obstacle {
            background-color: #ff6b6b;
            color: #fff;
        }

        .path {
            background-color: #4caf50;
            color: #fff;
        }

        button {
            font-size: 16px;
            padding: 10px 20px;
            margin: 20px;
            border: none;
            background-color: #4caf50;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        #commandsOutput {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background: #fff;
        }
    </style>
</head>
<body>
    <div id="gridContainer">
        <div id="rowLabels"></div>
        <div id="columnLabels"></div>
        <div id="grid"></div>
    </div>
    <button onclick="runAlgo()">Run Algo</button>
    <div id="commandsOutput"></div>
    <script>
        const gridSize = 20;
        const grid = document.getElementById('grid');
        const rowLabels = document.getElementById('rowLabels');
        const columnLabels = document.getElementById('columnLabels');
        const directions = ["↑", "→", "↓", "←"];
        let directionIndex = 0;
        let obstacleCounter = 1;

        for (let i = 0; i < gridSize; i++) {
            const rowLabel = document.createElement('div');
            const columnLabel = document.createElement('div');
            rowLabel.classList.add('label');
            columnLabel.classList.add('label');
            rowLabel.textContent = gridSize - i - 1;
            columnLabel.textContent = i;
            rowLabels.appendChild(rowLabel);
            columnLabels.appendChild(columnLabel);
        }

        for (let i = 0; i < gridSize * gridSize; i++) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.dataset.id = i;
            cell.dataset.direction = "0";
            cell.addEventListener('click', toggleObstacle);
            grid.appendChild(cell);
        }

        function toggleObstacle(event) {
            const cell = event.target;
            if (cell.classList.contains('obstacle')) {
                directionIndex = (directionIndex + 1) % 4;
                cell.dataset.direction = directionIndex * 2;
            } else {
                cell.classList.add('obstacle');
                cell.dataset.direction = directionIndex * 2;
                cell.dataset.obstacleNumber = obstacleCounter++;
            }
            updateCellContent(cell);
        }

        function updateCellContent(cell) {
            const obstacleNumber = cell.dataset.obstacleNumber || "";
            cell.textContent = obstacleNumber + directions[parseInt(cell.dataset.direction) / 2];
        }

        async function runAlgo() {
    const obstacles = [...document.querySelectorAll('.obstacle')].map(cell => {
        const index = parseInt(cell.dataset.id, 10);
        const obstacleNumber = parseInt(cell.dataset.obstacleNumber, 10);
        return {
            x: index % gridSize,
            y: gridSize - Math.floor(index / gridSize) - 1,
            id: obstacleNumber, // Passing the obstacle number as the id
            d: parseInt(cell.dataset.direction, 10)
        };
    });

    const response = await fetch('https://sc2079-algo-production.up.railway.app/get_path', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            cat: "obstacles",
            value: {
                obstacles,
                mode: "0"
            }
        })
    });

    const data = await response.json();
    displayCommands(data.value.commands);
}


        function displayCommands(commands) {
            const commandsOutput = document.getElementById('commandsOutput');
            commandsOutput.innerHTML = commands.join('<br>');
        }
    </script>
</body>
</html>
